<html>
<Head>
  <style>
.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;


  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  -ms-transform: translate(-50%, -50%); /* for IE 9 */
  -webkit-transform: translate(-50%, -50%); /* for Safari */

  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</Head>
<body>
<script>

var sharpnessValue = 0 ;

function PreviewImage() {
    let file = document.getElementById("uploadImage").files;
    if(file){
      var oFReader = new FileReader();
      oFReader.readAsDataURL(file[0]);
      oFReader.onload = function (oFREvent) {
        let uploadPreview = document.getElementById("uploadPreview");
        document.getElementById("uploadPreview").src = oFREvent.target.result;
        uploadPreview.onload = function(e){
          crop();
        }
      };
    }

};

function onAcuantSdkLoaded(){
  init();
}

function init() {
  let base64Token = btoa("Username:Password");
  AcuantJavascriptWebSdk.initialize(base64Token, "https://services.assureid.net", {
    onSuccess: function(){
      console.log("intialize succeded");
    },
    onFail: function(){
      console.log("intialize failed");
    }});
}

function end() {
  AcuantJavascriptWebSdk.end();
}

function crop() {
  let scaledWidth = 2560,
    scaledHeight = 1920,
    img = new Image();
    img.src = document.getElementById("uploadPreview").src;

  var width = img.width,
      height = img.height;

  var largerDimension = width > height ? width : height;


  if (largerDimension > scaledWidth) {
      if (width > height) {
          var aspectRatio = height / width;
          height = Math.round(scaledWidth * aspectRatio);
          width = scaledWidth;
      }
      else {
          var aspectRatio = width / height;
          height = scaledHeight;
          width = Math.round(scaledHeight * aspectRatio);
      }
  }

  var canvas = document.createElement("canvas");
	canvas.width = width;
	canvas.height = height;
	var c = canvas.getContext("2d");
  c.drawImage(img, 0, 0, width, height);
  var imgData = c.getImageData(0, 0, width, height);

  AcuantJavascriptWebSdk.crop(imgData, width, height, {
    onSuccess: function(response){
      var image = new Image();
      image.onload = function() {
        var croppedCanvas = document.getElementById("croppedPreview");
        croppedCanvas.width = response.image.width;
        croppedCanvas.height = response.image.height;
        var cContext = croppedCanvas.getContext("2d");
        cContext.drawImage(image, 0, 0);
      };
      image.src = response.image.data;
      document.getElementById("sharpnessOutput").value = response.sharpness;
      document.getElementById("glareOutput").value = response.glare;
    },
    onFail: function(){
      console.log("we failed");
    }
  });
}
</script>
<script async src="AcuantJavascriptWebSdk.js"></script>

<div class="container">
  <div class="row form-group">
    <div class="col-md-1">
        <button class="btn btn-info" onclick="init()">Initalize Worker</button>
    </div>
    <div class="col-md-1">
    </div>
    <div class="col-md-1">
        <button class="btn btn-danger" onclick="end()">End Worker</button>
    </div>
  </div>
  <div class="row form-group">
      <div class="col-md-12 text-center">
          <img id="uploadPreview" style="width: 80%; height: auto; min-height:250px" />
      </div>
  </div>
  <div class="row form-group">
      <div class="col-md-12 text-right">
          <input id="uploadImage" type="file" name="myPhoto" onchange="PreviewImage();" />
      </div>
  </div>
  <!-- <div class="row form-group" style="margin-top:4%;">
      <div class="col-md-6">
        <div class="form-inline">
          <div class="form-group"></div>
            <label for="width">Scaled Width: </label>
            <input class="form-control" id="width" type="number" placeholder="0" value="0" />
        </div>
      </div>
      <div class="col-md-6">
          <div class="form-inline">
            <div class="form-group"></div>
              <label for="width">Scaled Height: </label>
              <input class="form-control" id="height" type="number" placeholder="0" value="0"  />
          </div>
        </div>
  </div> -->
  <div class="row form-group" >
      <div class="col-md-12 text-right">
          <button class="btn btn-success"onclick="crop()">Crop</button>
      </div>
  </div>

  <div class="row form-group">
    <div class="col-md-12 text-center">
        <canvas id="croppedPreview" style="width:80%; height:auto"/>
    </div>
  </div>

  <div class="row form-group" style="margin-bottom:10%;">
      <div class="col-md-6">
          <label for="sharpnessOutput" >Sharpness: </label><textarea class="form-control" id="sharpnessOutput"></textarea>
      </div>
      <div class="col-md-6">
          <label for="glareOutput" >Glare: </label><textarea class="form-control" id="glareOutput"></textarea>
      </div>
    </div>
  
</div>
</html>
